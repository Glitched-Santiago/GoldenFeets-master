<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base/base-cliente}">
<head>
    <title th:text="${producto.nombre}"></title>
    <style>
        /* Sistema de diseño inspirado en Nike con layout de galería lateral */
        :root {
            --nike-spacing: 1.5rem;
            --nike-border-radius: 4px;
            --transition-base: 0.15s ease-in-out;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        .product-detail-page {
            padding: 2rem 1rem;
            max-width: 1440px;
            margin: 0 auto;
        }

        /* Layout de 3 columnas: thumbnails + imagen principal + info */
        .product-detail-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        @media (min-width: 968px) {
            .product-detail-grid {
                grid-template-columns: 80px 1fr 450px;
                gap: 1.5rem;
            }
        }

        /* Galería de miniaturas vertical estilo Nike */
        .product-thumbnails {
            display: none;
        }

        @media (min-width: 968px) {
            .product-thumbnails {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }

            .thumbnail-item {
                width: 80px;
                height: 80px;
                border-radius: var(--nike-border-radius);
                overflow: hidden;
                cursor: pointer;
                border: 2px solid transparent;
                transition: var(--transition-base);
            }

            .thumbnail-item:hover,
            .thumbnail-item.active {
                border-color: hsl(var(--foreground));
            }

            .thumbnail-item img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
        }

        /* Imagen principal más grande y limpia */
        .product-image-gallery {
            position: relative;
            background: hsl(var(--muted) / 0.3);
            border-radius: var(--nike-border-radius);
            overflow: hidden;
            aspect-ratio: 1 / 1;
        }

        .product-image-gallery img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Panel de información estilo Nike con mejor jerarquía */
        .product-info {
            padding: 0 1rem;
        }

        @media (min-width: 968px) {
            .product-info {
                padding: 1.5rem 0;
            }
        }

        .product-info .product-title {
            font-size: 1.75rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            line-height: 1.2;
            color: hsl(var(--foreground));
        }

        .product-subtitle {
            font-size: 1rem;
            color: hsl(var(--muted-foreground));
            margin-bottom: 1.5rem;
        }

        /* Precio estilo Nike con descuento */
        .price-section {
            margin-bottom: 2rem;
        }

        .price-container {
            display: flex;
            align-items: baseline;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .product-info .product-price {
            font-size: 1.5rem;
            font-weight: 500;
            color: hsl(var(--foreground));
            margin: 0;
        }

        .price-original {
            font-size: 1.125rem;
            color: hsl(var(--muted-foreground));
            text-decoration: line-through;
        }

        .price-discount {
            font-size: 1.125rem;
            color: hsl(142 76% 36%);
            font-weight: 600;
        }

        /* Selector de color/variante con miniaturas */
        .variant-selector {
            margin-bottom: 2rem;
        }

        .variant-label {
            font-size: 0.9375rem;
            font-weight: 500;
            color: hsl(var(--foreground));
            margin-bottom: 0.75rem;
            display: block;
        }

        .variant-options {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .variant-option {
            width: 80px;
            height: 80px;
            border-radius: var(--nike-border-radius);
            overflow: hidden;
            cursor: pointer;
            border: 2px solid hsl(var(--border));
            transition: var(--transition-base);
        }

        .variant-option:hover,
        .variant-option.selected {
            border-color: hsl(var(--foreground));
        }

        .variant-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Selector de talla estilo Nike con botones */
        .size-selector {
            margin-bottom: 1.5rem;
        }

        .size-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .size-label {
            font-size: 0.9375rem;
            font-weight: 500;
            color: hsl(var(--foreground));
        }

        .size-guide {
            font-size: 0.875rem;
            color: hsl(var(--muted-foreground));
            text-decoration: underline;
            cursor: pointer;
        }

        .size-guide:hover {
            color: hsl(var(--foreground));
        }

        .size-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 0.5rem;
        }

        .size-option {
            padding: 0.875rem;
            border: 1px solid hsl(var(--border));
            border-radius: var(--nike-border-radius);
            background: hsl(var(--background));
            cursor: pointer;
            text-align: center;
            font-size: 0.9375rem;
            font-weight: 500;
            transition: var(--transition-base);
        }

        .size-option:hover {
            border-color: hsl(var(--foreground));
        }

        .size-option.selected {
            border-color: hsl(var(--foreground));
            border-width: 2px;
        }

        .size-option.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            text-decoration: line-through;
        }

        /* Botón de añadir al carrito estilo Nike */
        .add-to-cart-btn {
            width: 100%;
            background: hsl(var(--foreground));
            color: hsl(var(--background));
            border: none;
            border-radius: 30px;
            padding: 1.375rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-base);
            text-transform: none;
            letter-spacing: 0;
            margin-bottom: 1rem;
        }

        .add-to-cart-btn:hover {
            background: hsl(var(--foreground) / 0.8);
            transform: none;
        }

        /* Información de envío estilo Nike */
        .shipping-info {
            padding: 1.5rem 0;
            border-top: 1px solid hsl(var(--border));
            margin-top: 1.5rem;
        }

        .shipping-title {
            font-size: 1rem;
            font-weight: 500;
            color: hsl(var(--foreground));
            margin-bottom: 0.5rem;
        }

        .shipping-text {
            font-size: 0.9375rem;
            color: hsl(var(--muted-foreground));
            line-height: 1.6;
        }

        .shipping-link {
            color: hsl(var(--muted-foreground));
            text-decoration: underline;
            cursor: pointer;
        }

        .shipping-link:hover {
            color: hsl(var(--foreground));
        }

        /* Descripción del producto con mejor formato */
        .product-description-section {
            padding: 2rem 0;
            border-top: 1px solid hsl(var(--border));
            margin-top: 1rem;
        }

        .product-info .product-description {
            line-height: 1.75;
            color: hsl(var(--foreground));
            font-size: 0.9375rem;
            margin: 0;
        }

        .product-attributes {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid hsl(var(--border));
        }

        .attribute-item {
            display: flex;
            gap: 0.5rem;
            font-size: 0.9375rem;
            color: hsl(var(--foreground));
        }

        .attribute-item strong {
            min-width: 80px;
            color: hsl(var(--muted-foreground));
            font-weight: 500;
        }

        /* Badge de stock minimalista */
        .stock-badge {
            display: inline-block;
            color: hsl(142 76% 36%);
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .stock-badge.out-of-stock {
            color: hsl(var(--destructive));
        }

        /* Alertas minimalistas */
        .alert {
            padding: 1rem;
            border-radius: var(--nike-border-radius);
            margin-bottom: 1.5rem;
            font-size: 0.9375rem;
        }

        .alert-success {
            background: hsl(142 76% 36% / 0.1);
            color: hsl(142 76% 36%);
        }

        .alert-error {
            background: hsl(var(--destructive) / 0.1);
            color: hsl(var(--destructive));
        }

        /* Input de cantidad oculto - integrado en el flujo */
        .quantity-input {
            display: none;
        }

        /* Responsive mejorado */
        @media (max-width: 967px) {
            .product-info .product-title { font-size: 1.5rem; }
            .size-options { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
<section layout:fragment="content">
    <div class="container product-detail-page">
        <!-- Alertas -->
        <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
        <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

        <div class="product-detail-grid" th:object="${producto}">
            <!-- Galería de miniaturas vertical (solo desktop) -->
            <div class="product-thumbnails">
                <div class="thumbnail-item active">
                    <img th:src="*{imagenUrl}" th:alt="*{nombre}"
                         onerror="this.src='https://placehold.co/80x80/F3F4F6/6B7280?text=1';"/>
                </div>
                <div class="thumbnail-item">
                    <img th:src="*{imagenUrl}" th:alt="*{nombre}"
                         onerror="this.src='https://placehold.co/80x80/F3F4F6/6B7280?text=2';"/>
                </div>
                <div class="thumbnail-item">
                    <img th:src="*{imagenUrl}" th:alt="*{nombre}"
                         onerror="this.src='https://placehold.co/80x80/F3F4F6/6B7280?text=3';"/>
                </div>
            </div>

            <!-- Imagen principal limpia -->
            <div class="product-image-gallery">
                <img th:src="*{imagenUrl}" th:alt="*{nombre}"
                     onerror="this.src='https://placehold.co/800x800/F3F4F6/6B7280?text=Imagen+no+disponible';"/>
            </div>

            <!-- Panel de información estilo Nike -->
            <div class="product-info">
                <h1 class="product-title" th:text="*{nombre}"></h1>
                <p class="product-subtitle" th:text="*{descripcion != null && !#strings.isEmpty(descripcion)} ? ${#strings.abbreviate(producto.descripcion, 60)} : 'Producto de alta calidad'"></p>

                <!-- Sección de precio con descuento -->
                <div class="price-section">
                    <div class="price-container">
                        <p class="product-price" th:text="'$ ' + ${#numbers.formatDecimal(producto.precio, 1, 'POINT', 2, 'COMMA')}"></p>
                        <!-- Simulación de precio original y descuento -->
                        <span class="price-original" th:text="'$ ' + ${#numbers.formatDecimal(producto.precio * 1.25, 1, 'POINT', 2, 'COMMA')}"></span>
                        <span class="price-discount">25% de descuento</span>
                    </div>
                </div>

                <!-- Selector de variante/color con miniaturas -->
                <div class="variant-selector" th:if="*{color != null and !color.isEmpty()}">
                    <label class="variant-label" th:text="'Color: ' + *{color}">Color</label>
                    <div class="variant-options">
                        <div class="variant-option selected">
                            <img th:src="*{imagenUrl}" th:alt="*{color}"
                                 onerror="this.src='https://placehold.co/80x80/F3F4F6/6B7280?text=C1';"/>
                        </div>
                    </div>
                </div>

                <!-- Selector de talla estilo Nike con botones -->
                <div class="size-selector" th:if="*{talla != null and !talla.isEmpty()}">
                    <div class="size-header">
                        <label class="size-label">Selecciona la Talla</label>
                        <span class="size-guide">Guía de tallas</span>
                    </div>
                    <div class="size-options">
                        <div class="size-option" th:text="'S'">S</div>
                        <div class="size-option selected" th:text="*{talla}">M</div>
                        <div class="size-option" th:text="'L'">L</div>
                        <div class="size-option" th:text="'XL'">XL</div>
                    </div>
                </div>

                <!-- Formulario simplificado con botón grande -->
                <form th:action="@{/carrito/agregar/{id}(id=*{id})}" method="post" th:if="*{stock > 0}">
                    <input type="hidden" name="cantidad" value="1" />
                    <button type="submit" class="add-to-cart-btn">Agregar a la bolsa de compras</button>
                </form>

                <div th:if="*{stock <= 0}">
                    <button class="add-to-cart-btn" disabled style="opacity: 0.5; cursor: not-allowed;">Agotado</button>
                </div>

                <!-- Información de envío estilo Nike -->
                <div class="shipping-info">
                    <div class="shipping-title">Envío</div>
                    <p class="shipping-text">
                        Para obtener información de envío precisa<br/>
                        <span class="shipping-link">Editar ubicación</span>
                    </p>
                </div>

                <!-- Descripción detallada del producto -->
                <div class="product-description-section">
                    <p class="product-description" th:text="*{descripcion}"></p>

                    <div class="product-attributes">
                        <div class="attribute-item" th:if="*{talla != null and !talla.isEmpty()}">
                            <strong>Talla</strong>
                            <span th:text="*{talla}"></span>
                        </div>
                        <div class="attribute-item" th:if="*{color != null and !color.isEmpty()}">
                            <strong>Color</strong>
                            <span th:text="*{color}"></span>
                        </div>
                        <div class="attribute-item">
                            <strong>Stock</strong>
                            <span th:text="*{stock > 0} ? (*{stock} + ' disponibles') : 'Agotado'"
                                  th:classappend="*{stock > 0} ? 'text-green-600' : 'text-red-600'"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
</body>
</html>
